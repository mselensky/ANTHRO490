<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Chapter 3 Silva-based classification without filtering | ANTHRO 490 Final Project</title>
  <meta name="description" content="This book details the workflow I followed in my final project for ANTHRO 490.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="Chapter 3 Silva-based classification without filtering | ANTHRO 490 Final Project" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book details the workflow I followed in my final project for ANTHRO 490." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Silva-based classification without filtering | ANTHRO 490 Final Project" />
  
  <meta name="twitter:description" content="This book details the workflow I followed in my final project for ANTHRO 490." />
  

<meta name="author" content="Matt Selensky">


<meta name="date" content="2019-03-19">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="silva-based-classification-with-filtering.html">
<link rel="next" href="results.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Project context and overview</a></li>
<li class="chapter" data-level="2" data-path="silva-based-classification-with-filtering.html"><a href="silva-based-classification-with-filtering.html"><i class="fa fa-check"></i><b>2</b> Silva-based classification with filtering</a></li>
<li class="chapter" data-level="3" data-path="silva-based-classification-without-filtering.html"><a href="silva-based-classification-without-filtering.html"><i class="fa fa-check"></i><b>3</b> Silva-based classification without filtering</a><ul>
<li class="chapter" data-level="3.1" data-path="silva-based-classification-without-filtering.html"><a href="silva-based-classification-without-filtering.html#taxonomy-assignment-using-silva"><i class="fa fa-check"></i><b>3.1</b> Taxonomy assignment using Silva <br></a></li>
<li class="chapter" data-level="3.2" data-path="silva-based-classification-without-filtering.html"><a href="silva-based-classification-without-filtering.html#taxa-barplot"><i class="fa fa-check"></i><b>3.2</b> Taxa barplot <br></a></li>
<li class="chapter" data-level="3.3" data-path="silva-based-classification-without-filtering.html"><a href="silva-based-classification-without-filtering.html#phylogenetic-tree"><i class="fa fa-check"></i><b>3.3</b> Phylogenetic tree</a></li>
<li class="chapter" data-level="3.4" data-path="silva-based-classification-without-filtering.html"><a href="silva-based-classification-without-filtering.html#core-diversity-metrics"><i class="fa fa-check"></i><b>3.4</b> Core diversity metrics <br></a></li>
<li class="chapter" data-level="3.5" data-path="silva-based-classification-without-filtering.html"><a href="silva-based-classification-without-filtering.html#alpha-diversity-significance"><i class="fa fa-check"></i><b>3.5</b> Alpha diversity significance <br></a></li>
<li class="chapter" data-level="3.6" data-path="silva-based-classification-without-filtering.html"><a href="silva-based-classification-without-filtering.html#nmds-plots-in-r"><i class="fa fa-check"></i><b>3.6</b> NMDS plots in R <br></a><ul>
<li class="chapter" data-level="3.6.1" data-path="silva-based-classification-without-filtering.html"><a href="silva-based-classification-without-filtering.html#phylum-level-nmds-script"><i class="fa fa-check"></i><b>3.6.1</b> Phylum-level NMDS script:</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="results.html"><a href="results.html"><i class="fa fa-check"></i><b>4</b> Results</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">ANTHRO 490 Final Project</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="silva-based-classification-without-filtering" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Silva-based classification without filtering</h1>
<div id="taxonomy-assignment-using-silva" class="section level2">
<h2><span class="header-section-number">3.1</span> Taxonomy assignment using Silva <br></h2>
<p>Since I am analyzing environmental data, I used the Silva database (132.99). I used the sklearn classification algorithm. <br> I used the same <code>--i-reads</code> as detailed in Chapter2 (De novo clustering). These are seqs clustered using a 97% cutoff, but no filtering was performed on them:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">qiime</span> feature-classifier classify-sklearn 
    <span class="ex">--i-classifier</span> /projects/e30740/qiime2_classifiers/silva-132-99-nb-classifier.qza 
    <span class="ex">--i-reads</span> /projects/e30740/mselensky/FinalProject/rep-LABEseqs-dn-97.qza
    <span class="ex">--o-classification</span> /projects/e30740/mselensky/FinalProject/NoFiltering/taxonomy_unfiltered.qza</code></pre></div>
<p>I was not able to visualize the resultant taxonomy.qza file as a table using metadata tabulate. I had to employ the following workaround, which allowed me to visualize my taxonomy information in tabular form:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">qiime</span> metadata tabulate 
    <span class="ex">--m-input-file</span> /projects/e30740/mselensky/FinalProject/NoFiltering/taxonomy_unfiltered.qza
    <span class="ex">--o-visualization</span> /projects/e30740/mselensky/FinalProject/NoFiltering/taxonomy_unfiltered.qzv
<span class="ex">qiime</span> tools export 
    <span class="ex">--input-path</span> /projects/e30740/mselensky/FinalProject/NoFiltering/taxonomy_unfiltered.qza 
    <span class="ex">--output-path</span> --output-path /projects/e30740/mselensky/FinalProject/NoFiltering/taxonomy-with-spaces
<span class="ex">qiime</span> metadata tabulate 
    <span class="ex">--m-input-file</span> /projects/e30740/mselensky/FinalProject/NoFiltering/taxonomy-with-spaces/taxonomy.tsv 
    <span class="ex">--o-visualization</span> /projects/e30740/mselensky/FinalProject/NoFiltering/taxonomy-as-metadata_unfiltered.qzv
<span class="ex">qiime</span> tools export 
    <span class="ex">--input-path</span> /projects/e30740/mselensky/FinalProject/NoFiltering/taxonomy-as-metadata_unfiltered.qzv 
    <span class="ex">--output-path</span> /projects/e30740/mselensky/FinalProject/NoFiltering/taxonomy-as-metadata
<span class="ex">qiime</span> tools import 
    <span class="ex">--type</span> <span class="st">&#39;FeatureData[Taxonomy]&#39;</span> 
    <span class="ex">--input-path</span> /projects/e30740/mselensky/FinalProject/NoFiltering/taxonomy-as-metadata/metadata.tsv 
    <span class="ex">--output-path</span> /projects/e30740/mselensky/FinalProject/NoFiltering/taxonomy-without-spaces_unfiltered.qza

    <span class="ex">qiime</span> metadata tabulate 
        <span class="ex">--m-input-file</span> /projects/e30740/mselensky/FinalProject/NoFiltering/taxonomy-without-spaces_unfiltered.qza 
        <span class="ex">--o-visualization</span> /projects/e30740/mselensky/FinalProject/NoFiltering/taxonomy-without-spaces_unfiltered.qzv</code></pre></div>
</div>
<div id="taxa-barplot" class="section level2">
<h2><span class="header-section-number">3.2</span> Taxa barplot <br></h2>
<p>This yielded a taxa barplot as an output (before rarefaction):</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">qiime</span> taxa barplot 
    <span class="ex">--i-table</span> /projects/e30740/mselensky/FinalProject/NoFiltering/LABEtable_unaltered-dn-97.qza
    <span class="ex">--i-taxonomy</span> /projects/e30740/mselensky/FinalProject/NoFiltering/taxonomy_unfiltered.qza
    <span class="ex">--m-metadata-file</span> /projects/e30740/mselensky/FinalProject/LABEmetadata_all_samples.txt
    <span class="ex">--o-visualization</span> /projects/e30740/mselensky/FinalProject/NoFiltering/LABE_taxa_barplot_unfiltered.qzv</code></pre></div>
</div>
<div id="phylogenetic-tree" class="section level2">
<h2><span class="header-section-number">3.3</span> Phylogenetic tree</h2>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">qiime</span> phylogeny align-to-tree-mafft-fasttree
  <span class="ex">--i-sequences</span> /projects/e30740/mselensky/FinalProject/NoFiltering/rep-LABEseqs_unaltered-dn-97.qza
  <span class="ex">--o-alignment</span> /projects/e30740/mselensky/FinalProject/NoFiltering/Phylogeny/LABEseqs_unaltered-dn-97_aligned
  <span class="ex">--o-masked-alignment</span> /projects/e30740/mselensky/FinalProject/NoFiltering/Phylogeny/LABEseqs_unaltered-dn-97_masked_aligned
  <span class="ex">--o-tree</span> /projects/e30740/mselensky/FinalProject/NoFiltering/Phylogeny/LABEtree_unfiltered
  <span class="ex">--o-rooted-tree</span> /projects/e30740/mselensky/FinalProject/NoFiltering/Phylogeny/LABEtree_rooted_unfiltered
  <span class="ex">--output-dir</span> /projects/e30740/mselensky/FinalProject/NoFiltering/Phylogeny</code></pre></div>
</div>
<div id="core-diversity-metrics" class="section level2">
<h2><span class="header-section-number">3.4</span> Core diversity metrics <br></h2>
<p>First, I made an alpha rarefaction plot to determine sampling depth:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">qiime</span> diversity alpha-rarefaction
    <span class="ex">--i-table</span> /projects/e30740/mselensky/FinalProject/NoFiltering/LABEtable_unaltered-dn-97.qza
    <span class="ex">--p-max-depth</span> 5000
    <span class="ex">--p-min-depth</span> 1
    <span class="ex">--p-steps</span> 10
    <span class="ex">--p-iterations</span> 10
    <span class="ex">--o-visualization</span> /projects/e30740/mselensky/FinalProject/NoFiltering/LABE_alpha_rarefied_table_unfiltered</code></pre></div>
<p>When sampling depth = 2000, <br> * Retained 58,000 (50.74%) sequences in 29 (96.67%) samples at the specifed sampling depth. <br> <br> Using the phylogenetic tree from step 8, I then measured diversity core metrics on my rarefied data with a sampling depth of 2000:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">qiime</span> diversity core-metrics-phylogenetic
<span class="ex">--i-phylogeny</span> /projects/e30740/mselensky/FinalProject/NoFiltering/Phylogeny/LABEtree_rooted_unfiltered.qza
<span class="ex">--i-table</span> /projects/e30740/mselensky/FinalProject/NoFiltering/LABEtable_unaltered-dn-97.qza
<span class="ex">--p-sampling-depth</span> 2000
<span class="ex">--m-metadata-file</span> /projects/e30740/mselensky/FinalProject/LABEmetadata_all_samples.txt
<span class="ex">--output-dir</span> /projects/e30740/mselensky/FinalProject/NoFiltering/CoreMetricsResults</code></pre></div>
<p><strong>Outputs give the following information:</strong> <br></p>
<p>ALPHA DIVERSITY CORE METRICS: <br></p>
<p><em>Shannon’s diversity index</em> <br> * A quantitative measure of community richness <br></p>
<p><em>Observed OTUs</em> <br> * A qualitative measure of community richness <br></p>
<p><em>Faith’s Phylogenetic Diversity</em> <br> * A qualitiative measure of community richness that incorporates phylogenetic relationships between the features <br></p>
<p><em>Evenness (or Pielou’s Evenness)</em> <br> * A measure of community evenness <br></p>
<hr />
<p>BETA DIVERSITY CORE METRICS: <br></p>
<p><em>Jaccard distance</em> <br> * A qualitative measure of community dissimilarity <br></p>
<p><em>Bray-Curtis</em> <br> * A quantitative measure of community dissimilarity <br></p>
<p><em>Unweighted UniFrac distance</em> <br> * A qualitative measure of community dissimilarity that incorporates phylogenetic relationships between features <br></p>
<p><em>Weighted UniFrac distance</em> <br> * A quantitative measure of community dissimilarity that incorporates phylogenetic relationships between features</p>
</div>
<div id="alpha-diversity-significance" class="section level2">
<h2><span class="header-section-number">3.5</span> Alpha diversity significance <br></h2>
<p>As in Chapter 2, I chose Shannon for all downstream alpha diversity analyses. I did not include other indices in my workflow this time to save space. <br> Alpha diversity group significance:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="co">#Shannon</span>
<span class="ex">qiime</span> diversity alpha-group-significance
  <span class="ex">--i-alpha-diversity</span> /projects/e30740/mselensky/FinalProject/NoFiltering/CoreMetricsResults/shannon_vector.qza
    <span class="ex">--m-metadata-file</span> /projects/e30740/mselensky/FinalProject/LABEmetadata_all_samples.txt
    <span class="ex">--o-visualization</span> /projects/e30740/mselensky/FinalProject/NoFiltering/CoreMetricsResults/shannon-group-significance_silv_unfiltered.qzv</code></pre></div>
<p>Alpha diversity correlation:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">qiime</span> diversity alpha-correlation
    <span class="ex">--i-alpha-diversity</span> /projects/e30740/mselensky/FinalProject/NoFiltering/CoreMetricsResults/shannon_vector.qza
    <span class="ex">--m-metadata-file</span> /projects/e30740/mselensky/FinalProject/LABEmetadata_all_samples.txt
    <span class="ex">--o-visualization</span> /projects/e30740/mselensky/FinalProject/NoFiltering/CoreMetricsResults/shannon-alpha-correlation.qzv </code></pre></div>
</div>
<div id="nmds-plots-in-r" class="section level2">
<h2><span class="header-section-number">3.6</span> NMDS plots in R <br></h2>
<div id="phylum-level-nmds-script" class="section level3">
<h3><span class="header-section-number">3.6.1</span> Phylum-level NMDS script:</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(vegan)
<span class="kw">library</span>(funrar)
<span class="kw">library</span>(plotly)

<span class="kw">rm</span>(<span class="dt">list=</span><span class="kw">ls</span>())

<span class="kw">getwd</span>()

<span class="kw">setwd</span>(<span class="st">&quot;C:/Users/msele/OneDrive/Documents/Winter2019_Classes/ANTHRO_490/Final_Project/core_metrics_unfiltered&quot;</span>)

L2 &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;level_2_unfiltered.csv&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">row.names =</span> <span class="dv">1</span>, <span class="dt">check.names =</span> <span class="ot">FALSE</span>)
L2_metadata &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;LABEmetadata_all_samples.txt&quot;</span>, <span class="dt">check.names =</span> <span class="ot">FALSE</span>, <span class="dt">fileEncoding =</span> <span class="st">&quot;UTF-8-BOM&quot;</span>)

L2_abun &lt;-<span class="st"> </span>L2[,<span class="kw">c</span>(<span class="op">-</span><span class="dv">43</span><span class="op">:-</span><span class="dv">55</span>)]

<span class="kw">is.data.frame</span>(L2_abun)
L2_transposed &lt;-<span class="st"> </span><span class="kw">t</span>(L2_abun)

<span class="co"># Convert L2 (an absolute abundance table) into relative abundance table</span>
mat =<span class="st"> </span><span class="kw">as.matrix</span>(L2_transposed)
<span class="kw">head</span>(mat)  <span class="co"># Has absolute abundances</span>
rel_mat =<span class="st"> </span><span class="kw">make_relative</span>(mat)
<span class="kw">head</span>(rel_mat)  <span class="co"># Relative abundances</span>

<span class="co"># Make_relative causes rel_mat to be atomic, not recursive. downstream data.frame only works on recursive objects </span>
<span class="kw">is.recursive</span>(rel_mat)
<span class="kw">is.atomic</span>(rel_mat)
rel_mat_recursive &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(rel_mat)
<span class="kw">is.recursive</span>(rel_mat_recursive)

rel_mat_recursive_t &lt;-<span class="st"> </span><span class="kw">t</span>(rel_mat_recursive)
<span class="kw">is.recursive</span>(rel_mat_recursive_t)
rel_mat_recursive_t &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(rel_mat_recursive_t)

<span class="co">#</span>
grouping_info &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">row.names =</span> <span class="kw">rownames</span>(rel_mat_recursive_t), <span class="kw">t</span>(<span class="kw">as.data.frame</span>(<span class="kw">strsplit</span>(<span class="kw">rownames</span>(rel_mat_recursive_t),<span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>))))
<span class="kw">head</span>(grouping_info)

NMDS_L2 &lt;-<span class="st"> </span><span class="kw">metaMDS</span>(rel_mat_recursive_t, <span class="dt">distance =</span> <span class="st">&quot;bray&quot;</span>, <span class="dt">k =</span> <span class="dv">2</span>, <span class="dt">try =</span> <span class="dv">20</span>, <span class="dt">trymax =</span> <span class="dv">100</span>)
<span class="kw">stressplot</span>(NMDS_L2, <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">cex=</span><span class="fl">0.75</span>, <span class="dt">l.col =</span> <span class="st">&quot;tomato&quot;</span>, <span class="dt">p.col =</span> <span class="st">&quot;skyblue&quot;</span>)

info_L2 =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x=</span>NMDS_L2<span class="op">$</span>point[,<span class="dv">2</span>],<span class="dt">y=</span>NMDS_L2<span class="op">$</span>point[,<span class="dv">1</span>],<span class="dt">SampleID =</span> <span class="kw">as.factor</span>(grouping_info[,<span class="dv">1</span>]))

<span class="co"># Merge metadata file with info_L5, which contains NMDS coordinates</span>
L2_merged &lt;-<span class="st"> </span><span class="kw">merge</span>(info_L2, L2_metadata, <span class="dt">by.x =</span> <span class="st">&quot;SampleID&quot;</span>, <span class="dt">by.y =</span> <span class="st">&quot;SampleID&quot;</span>)

<span class="co"># Plot NMDS</span>
p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(L2_merged, <span class="kw">aes</span>(x, y, <span class="dt">label=</span><span class="st">&quot;&quot;</span>, <span class="dt">color =</span> Type, <span class="dt">group =</span> Type, <span class="dt">text =</span> <span class="kw">paste</span>(<span class="st">&quot;Cave: &quot;</span>, Cave))) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_shape_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">17</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;NMDS of Phylum-Level Taxonomy using Silva without Filtering&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">stat_ellipse</span>(<span class="dt">geom =</span> <span class="st">&quot;path&quot;</span>)

p &lt;-<span class="st"> </span><span class="kw">ggplotly</span>(p)

p</code></pre></div>
<p>Stressplot for Silva-based, unfiltered, phylum-level NMDS:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Stress plot</span>
<span class="kw">stressplot</span>(NMDS_L2, <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">cex=</span><span class="fl">0.75</span>, <span class="dt">l.col =</span> <span class="st">&quot;tomato&quot;</span>, <span class="dt">p.col =</span> <span class="st">&quot;skyblue&quot;</span>)</code></pre></div>
<p><br> ### Family-level NMDS scripts: <br></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># ANTHRO 490 final project - NMDS plots</span>
<span class="co"># Silva without Filtering</span>
<span class="co"># Winter 2019</span>

<span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(vegan)
<span class="kw">library</span>(funrar)
<span class="kw">library</span>(plotly)

<span class="kw">rm</span>(<span class="dt">list=</span><span class="kw">ls</span>())

<span class="kw">getwd</span>()

<span class="kw">setwd</span>(<span class="st">&quot;C:/Users/msele/OneDrive/Documents/Winter2019_Classes/ANTHRO_490/Final_Project/core_metrics_unfiltered&quot;</span>)

L5 &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;level_5_unfiltered.csv&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">row.names =</span> <span class="dv">1</span>, <span class="dt">check.names =</span> <span class="ot">FALSE</span>)
L5_metadata &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;LABEmetadata_all_samples.txt&quot;</span>, <span class="dt">check.names =</span> <span class="ot">FALSE</span>, <span class="dt">fileEncoding =</span> <span class="st">&quot;UTF-8-BOM&quot;</span>)

L5_abun &lt;-<span class="st"> </span>L5[,<span class="kw">c</span>(<span class="op">-</span><span class="dv">726</span><span class="op">:-</span><span class="dv">738</span>)]

<span class="kw">is.data.frame</span>(L5_abun)
L5_transposed &lt;-<span class="st"> </span><span class="kw">t</span>(L5_abun)

<span class="co"># Convert L2 (an absolute abundance table) into relative abundance table</span>
mat =<span class="st"> </span><span class="kw">as.matrix</span>(L5_transposed)
<span class="kw">head</span>(mat)  <span class="co"># Has absolute abundances</span>
rel_mat =<span class="st"> </span><span class="kw">make_relative</span>(mat)
<span class="kw">head</span>(rel_mat)  <span class="co"># Relative abundances</span>

<span class="co"># Make_relative causes rel_mat to be atomic, not recursive. downstream data.frame only works on recursive objects </span>
<span class="kw">is.recursive</span>(rel_mat)
<span class="kw">is.atomic</span>(rel_mat)
rel_mat_recursive &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(rel_mat)
<span class="kw">is.recursive</span>(rel_mat_recursive)

rel_mat_recursive_t &lt;-<span class="st"> </span><span class="kw">t</span>(rel_mat_recursive)
<span class="kw">is.recursive</span>(rel_mat_recursive_t)
rel_mat_recursive_t &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(rel_mat_recursive_t)

<span class="co">#</span>
grouping_info &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">row.names =</span> <span class="kw">rownames</span>(rel_mat_recursive_t), <span class="kw">t</span>(<span class="kw">as.data.frame</span>(<span class="kw">strsplit</span>(<span class="kw">rownames</span>(rel_mat_recursive_t),<span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>))))
<span class="kw">head</span>(grouping_info)

NMDS_L5 &lt;-<span class="st"> </span><span class="kw">metaMDS</span>(rel_mat_recursive_t, <span class="dt">distance =</span> <span class="st">&quot;bray&quot;</span>, <span class="dt">k =</span> <span class="dv">2</span>, <span class="dt">try =</span> <span class="dv">20</span>, <span class="dt">trymax =</span> <span class="dv">100</span>)
<span class="kw">stressplot</span>(NMDS_L5, <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">cex=</span><span class="fl">0.75</span>, <span class="dt">l.col =</span> <span class="st">&quot;tomato&quot;</span>, <span class="dt">p.col =</span> <span class="st">&quot;skyblue&quot;</span>)

info_L5 =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x=</span>NMDS_L5<span class="op">$</span>point[,<span class="dv">2</span>],<span class="dt">y=</span>NMDS_L5<span class="op">$</span>point[,<span class="dv">1</span>],<span class="dt">SampleID =</span> <span class="kw">as.factor</span>(grouping_info[,<span class="dv">1</span>]))

<span class="co"># Merge metadata file with info_L5, which contains NMDS coordinates</span>
L5_merged &lt;-<span class="st"> </span><span class="kw">merge</span>(info_L5, L5_metadata, <span class="dt">by.x =</span> <span class="st">&quot;SampleID&quot;</span>, <span class="dt">by.y =</span> <span class="st">&quot;SampleID&quot;</span>)

<span class="co"># Plot NMDS</span>
p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(L5_merged, <span class="kw">aes</span>(x, y, <span class="dt">label=</span><span class="st">&quot;&quot;</span>, <span class="dt">color =</span> Type, <span class="dt">group =</span> Type, <span class="dt">text =</span> <span class="kw">paste</span>(<span class="st">&quot;Cave: &quot;</span>, Cave))) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_shape_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">17</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;NMDS of Family-Level Taxonomy using Silva without Filtering&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">stat_ellipse</span>(<span class="dt">geom =</span> <span class="st">&quot;path&quot;</span>)

p &lt;-<span class="st"> </span><span class="kw">ggplotly</span>(p)

p</code></pre></div>
<p><br> Family-level NMDS plot with ellipses indicating 95% confidence level at which ellipses were drawn:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Plot NMDS</span>
p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(L5_merged, <span class="kw">aes</span>(x, y, <span class="dt">label=</span><span class="st">&quot;&quot;</span>, <span class="dt">color =</span> Class, <span class="dt">group =</span> Mat_color, <span class="dt">text =</span> <span class="kw">paste</span>(<span class="st">&quot;Cave: &quot;</span>, Cave))) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st"> </span><span class="co"># scale_shape_manual(values=c(1:17)) +</span>
<span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="st">&quot;darkgoldenrod4&quot;</span>, <span class="st">&quot;tan&quot;</span>, <span class="st">&quot;grey88&quot;</span>, <span class="st">&quot;gold&quot;</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Family-level NMDS using Silva (without Filtering)&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="st">&quot;white&quot;</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">stat_ellipse</span>(<span class="dt">geom =</span> <span class="st">&quot;path&quot;</span>)

p &lt;-<span class="st"> </span><span class="kw">ggplotly</span>(p)

p</code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="silva-based-classification-with-filtering.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="results.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/02-literature.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
